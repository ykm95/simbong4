<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="page.dao.user.uservolunteer.UserVolunteerDao">

	<select id="selectVolunteerAll" parameterType="page.util.PagingVolunteer" resultType="page.util.PagingVolunteer">
		SELECT * FROM (
		SELECT rownum rnum, B.* FROM (
		SELECT V.*, A.aname, D.departname
		FROM volunteer V, area A, v_department D
		WHERE V.vol_area = A.areano
		AND V.department = D.departmentno

		<if test="v_process !=null and v_process !='' and v_process != 0 ">
			AND V.vol_process = #{v_process}
		</if>
		<if test="department!=null and department!='' ">
			AND V.department = #{department}
		</if>
		<if test="v_area!=null and v_area!='' ">
			AND V.vol_area = #{v_area}
		</if>
		<if test="v_sterm !=null and v_sterm!='' ">
			<![CDATA[
			AND (V.vol_sterm <= #{v_sterm} AND V.vol_sterm <= #{v_eterm} and
			V.vol_eterm>= #{v_sterm} and V.vol_eterm>= #{v_eterm}
			OR V.vol_sterm BETWEEN #{v_sterm} AND #{v_eterm}
			OR V.vol_eterm BETWEEN #{v_sterm} AND #{v_eterm})
			]]>
		</if>
		<if test="v_sterm !=null and v_sterm!='' ">
			<![CDATA[
			AND (V.stime <= #{v_stime} AND V.stime <= #{v_etime} and
			V.etime>= #{v_stime} and V.etime>= #{v_etime}
			OR V.stime BETWEEN #{v_stime} AND #{v_etime}
			OR V.etime BETWEEN #{v_stime} AND #{v_etime})
			]]>
		</if>
		<if test="search !=null and search !='' ">
			AND V.vol_title LIKE '%' || #{search} || '%'
		</if>
		ORDER BY V.volunteerno DESC
		) B
		ORDER BY rnum
		) VOLUNTEER
		WHERE rnum BETWEEN
		#{startNo} AND #{endNo}
	</select>
	
	<select id="selectCntVolunteer" parameterType="page.util.PagingVolunteer" resultType="int">
		SELECT COUNT(*) FROM (
		SELECT rownum rnum, B.* FROM (
		SELECT V.*, A.aname, D.departname
		FROM volunteer V, area A, v_department D
		WHERE V.vol_area = A.areano
		AND V.department = D.departmentno

		<if test="v_process !=null and v_process !='' and v_process != 0 ">
			AND V.vol_process = #{v_process}
		</if>
		<if test="department!=null and department!='' ">
			AND V.department = #{department}
		</if>
		<if test="v_area!=null and v_area!='' ">
			AND V.vol_area = #{v_area}
		</if>
		<if test="v_sterm !=null and v_sterm!='' ">
			<![CDATA[
			AND (V.vol_sterm <= #{v_sterm} AND V.vol_sterm <= #{v_eterm} and
			V.vol_eterm>= #{v_sterm} and V.vol_eterm>= #{v_eterm}
			OR V.vol_sterm BETWEEN #{v_sterm} AND #{v_eterm}
			OR V.vol_eterm BETWEEN #{v_sterm} AND #{v_eterm})
			]]>
		</if>
		<if test="v_sterm !=null and v_sterm!='' ">
			<![CDATA[
			AND (V.stime <= #{v_stime} AND V.stime <= #{v_etime} and
			V.etime>= #{v_stime} and V.etime>= #{v_etime}
			OR V.stime BETWEEN #{v_stime} AND #{v_etime}
			OR V.etime BETWEEN #{v_stime} AND #{v_etime})
			]]>
		</if>
		<if test="search !=null and search !='' ">
			AND V.vol_title LIKE '%' || #{search} || '%'
		</if>
		ORDER BY V.volunteerno DESC
		) B
		ORDER BY rnum
		) VOLUNTEER

	</select>
	
	<select id="selectVolunteerByNo" parameterType="int" resultType="page.dto.Volunteer">
		SELECT * FROM volunteer V, area A, v_department D
		WHERE V.vol_area = A.areano
		AND V.department = D.departmentno
		AND V.volunteerno = #{volunteerno}
	</select>
	
<!-- 	<select id="selectAplByNo" parameterType="int" resultType="web.user_page.volunteer.dto.Participant"> -->
<!-- 		SELECT participant.applicantno, participant.name, participant.email, participant.date  -->
<!-- 		FROM volunteer WHERE volunteerno = #{volunteerno} -->
<!-- 	</select> -->

	<select id="selectUserNo" parameterType="String" resultType="int">
		SELECT userno FROM usertb 
		WHERE uemail=#{uemail}
	</select>
	
	<select id="selectCntApl" parameterType="page.dto.Applicant" resultType="int">
		SELECT count(*) from applicant
		WHERE userno = #{userno}
		AND volunteerno = #{volunteerno}
	</select>
	
	<insert id="insertApl" parameterType="page.dto.Applicant">
		INSERT INTO applicant (applicantno, volunteerno, userno) VALUES(applicant_seq.nextval, #{volunteerno}, #{userno} )
	</insert>
	
	<delete id="deleteApl" parameterType="page.dto.Applicant">
		DELETE FROM applicant WHERE volunteerno = #{volunteerno} AND userno= #{userno}
	</delete>
	
</mapper>
