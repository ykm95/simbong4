<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="page.dao.user.talent.TalentDao">

	<select id="selectTalentAll"
		parameterType="page.util.PagingTalent"
		resultType="page.dto.Talent">
		SELECT * FROM (
		SELECT rownum rnum, T.* FROM (
		SELECT talent.*
		FROM
		talent
		WHERE 1=1

		<if test="t_process !=null and t_process !='' and t_process != 0 ">
			AND talent_process = #{t_process}
		</if>
		<if test="t_type !=null and t_type !='' and t_type != 0">
			AND talent_type = #{t_type}
		</if>
		<if test="t_department!=null and t_department!='' ">
			AND department = #{t_department}
		</if>
		<if test="t_area!=null and t_area!='' ">
			AND talent_area = #{t_area}
		</if>
		<if test="t_start !=null and t_start!='' ">
			<![CDATA[
			AND (talent_start <= #{t_start} AND talent_start <= #{t_end} and
			talent_end>= #{t_start} and talent_end>= #{t_end}
			OR talent_start BETWEEN #{t_start} AND #{t_end}
			OR talent_end BETWEEN #{t_start} AND #{t_end})
			]]>
		</if>

		<if test="t_cycle !=null">
		AND
			<foreach collection="t_cycle" item="cycle" open="(" close=")" separator="OR">
			talent_cycle LIKE '%'||#{cycle}||'%'
			</foreach>
		</if>
		<if test="t_title!=null and t_title!='' ">
			AND talent_title LIKE '%' || #{t_title} || '%'
		</if>
		ORDER BY talentno DESC
		) T
		ORDER BY rnum
		) TALENT
		WHERE rnum BETWEEN
		#{startNo} AND #{endNo}
	</select>

	<select id="selectCntTalent"
		parameterType="page.util.PagingTalent" resultType="int">
		SELECT COUNT(*) FROM talent
				
		WHERE 1=1

		<if test="t_process !=null and t_process !='' and t_process != 0 ">
			AND talent_process = #{t_process}
		</if>
		<if test="t_type !=null and t_type !='' and t_type != 0">
			AND talent_type = #{t_type}
		</if>
		<if test="t_department!=null and t_department!='' ">
			AND department = #{t_department}
		</if>
		<if test="t_area!=null and t_area!='' ">
			AND talent_area = #{t_area}
		</if>
		<if test="t_start !=null and t_start!='' ">
			<![CDATA[
			AND (talent_start <= #{t_start} AND talent_start <= #{t_end} and
			talent_end>= #{t_start} and talent_end>= #{t_end}
			OR talent_start BETWEEN #{t_start} AND #{t_end}
			OR talent_end BETWEEN #{t_start} AND #{t_end})
			]]>
		</if>
		<if test="t_cycle !=null">
		AND
			<foreach collection="t_cycle" item="cycle" open="(" close=")" separator="OR">
			talent_cycle LIKE '%'||#{cycle}||'%'
			</foreach>
		</if>
		<if test="t_title!=null and t_title!='' ">
			AND talent_title LIKE '%' || #{t_title} || '%'
		</if>

	</select>

	<select id="selectTalentByNo" parameterType="int"
		resultType="page.dto.Talent">
		SELECT * FROM talent WHERE talentno = #{talentno}
	</select>

	<insert id="insertTalent"
		parameterType="hashmap">
		INSERT INTO talent ( talentno, userno, talent_start, talent_end, talent_cycle,
			department, talent_title,
			talent_content, 
			talent_process, talent_area,
			talent_type)
		VALUES( talent_seq.nextval, usertb_seq.nextval, #{paging.t_start}, #{paging.t_end}, 
		<foreach collection="paging.t_cycle" item="tc" separator="||','||">
			#{tc}
		</foreach>
		,#{paging.t_department}, #{paging.t_title},
		 #{paging.t_content},
		#{paging.t_process},
		#{paging.t_area}, #{paging.t_type})
	</insert>

	<update id="updateTalent"
		parameterType="page.dto.Talent">
		UPDATE talent SET talent_start = #{talent_start},
		talent_end = #{talent_end}, talent_area = #{talent_area},
		 department = #{department},
		talent_title = #{talent_title}, talent_content = #{talent_content} WHERE talentno
		= #{talentno}
	</update>

	<delete id="deleteTalent" parameterType="int">
		DELETE FROM talent WHERE
		talentno = #{talentno}
	</delete>
</mapper>
